require 'opal'
require 'opal-rspec'
<% 
spec_opts = ENV['SPEC_OPTS']
formatter_require_match = /--require (\S+)/.match(spec_opts)
formatter_class_match = /--format (\S+)/.match(spec_opts)
if formatter_require_match and formatter_class_match
	required_formatter = formatter_require_match.captures[0]
	formatter_class = formatter_class_match.captures[0]
%>	
	require '<%= required_formatter %>'

	RSpec.configure do |config|
	  config.default_formatter = <%= formatter_class %>
	end

<% end %>

# We've interrupted the usual opal-rspec flow to set the formatter, now run the rest of the 's.main' code
# This environment variable was set in the RspecJunit Rake task
require <%= ENV['opal_rspec_after_formatter_set'].inspect %>
